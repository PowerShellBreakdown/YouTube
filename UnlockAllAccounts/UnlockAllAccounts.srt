1
00:00:01,352 --> 00:00:03,508
This is PowerShell Breakdown One-Liners

2
00:00:03,533 --> 00:00:06,156
where the entire script is written in just one line.

3
00:00:07,023 --> 00:00:09,023
(Ba-da-dum-tish)

4
00:00:09,625 --> 00:00:11,273
OK, now here's the real one.

5
00:00:12,195 --> 00:00:14,539
This one finds all of the Active Directory accounts

6
00:00:14,564 --> 00:00:17,031
that are locked out within an Organizational Unit

7
00:00:17,281 --> 00:00:18,727
and then unlocks them all.

8
00:00:20,422 --> 00:00:21,789
This really comes in handy

9
00:00:21,814 --> 00:00:23,938
when <i>something</i> causes large numbers of users

10
00:00:23,963 --> 00:00:25,914
to have their accounts become locked.

11
00:00:26,648 --> 00:00:28,625
When the IT team becomes overwhelmed

12
00:00:28,673 --> 00:00:29,703
with support calls,

13
00:00:29,734 --> 00:00:31,141
you can run this one-liner

14
00:00:31,166 --> 00:00:33,008
to stave off the angry mob long enough

15
00:00:33,033 --> 00:00:35,695
so you can fix whatever that <i>something</i> is.

16
00:00:38,070 --> 00:00:39,813
The command that unlocks accounts

17
00:00:39,838 --> 00:00:41,766
is called <u>Unlock-ADAccount</u>

18
00:00:41,791 --> 00:00:44,250
and it is fairly simple to use and understand.

19
00:00:44,883 --> 00:00:46,257
We only need to be concerned

20
00:00:46,282 --> 00:00:47,563
with the <u>-Identity</u> parameter,

21
00:00:47,588 --> 00:00:49,414
which identifies the account to unlock.

22
00:00:50,414 --> 00:00:52,344
I typically use the SAM account name

23
00:00:52,369 --> 00:00:53,539
to identify a user.

24
00:00:53,609 --> 00:00:55,719
It can be found in ADUC

25
00:00:55,744 --> 00:00:57,258
by double-clicking on the user,

26
00:00:57,523 --> 00:00:59,063
selecting the "Account" tab,

27
00:00:59,088 --> 00:01:02,609
and looking under "User Logon Name (Pre-Windows 2000)".

28
00:01:03,383 --> 00:01:06,188
I'll go ahead and copy the SAM account name to the clipboard.

29
00:01:08,930 --> 00:01:10,703
You can also use any of <i>these</i>,

30
00:01:10,728 --> 00:01:12,734
which are found in the "Attribute Editor" tab

31
00:01:18,281 --> 00:01:19,703
We know that Michelle's account

32
00:01:19,728 --> 00:01:21,664
is locked out by this message here.

33
00:01:23,195 --> 00:01:24,953
Now we can paste the SAM account name

34
00:01:24,978 --> 00:01:26,766
into PowerShell by right-clicking.

35
00:01:27,664 --> 00:01:29,007
Hit ENTER

36
00:01:29,117 --> 00:01:32,086
and verify the account is unlocked in ADUC.

37
00:01:34,953 --> 00:01:37,296
The message that was there before is now gone,

38
00:01:37,321 --> 00:01:38,953
so the account is now unlocked.

39
00:01:41,313 --> 00:01:43,039
That's how you unlock an account.

40
00:01:43,258 --> 00:01:44,500
Now I'll show you how to search

41
00:01:44,525 --> 00:01:46,750
for all of the accounts that are currently locked out.

42
00:01:48,172 --> 00:01:49,766
The command we're using this time

43
00:01:49,791 --> 00:01:51,430
is <u>Search-ADAccount</u>.

44
00:01:52,633 --> 00:01:54,438
This searches Active Directory

45
00:01:54,463 --> 00:01:55,539
for various things like

46
00:01:55,564 --> 00:01:57,492
expired or inactive accounts,

47
00:01:57,688 --> 00:01:59,039
expired passwords,

48
00:01:59,064 --> 00:02:00,586
and what we're using it for:

49
00:02:00,611 --> 00:02:02,023
<i>locked out accounts</i>.

50
00:02:04,373 --> 00:02:06,498
We'll use two parameters with this command:

51
00:02:07,646 --> 00:02:09,638
The first is <u>-LockedOut</u>.

52
00:02:09,951 --> 00:02:11,803
This will return the accounts

53
00:02:11,828 --> 00:02:13,107
that are currently locked out.

54
00:02:13,998 --> 00:02:16,178
The second is <u>-SearchBase</u>.

55
00:02:16,631 --> 00:02:18,584
This tells PowerShell <i>where</i> to search.

56
00:02:18,959 --> 00:02:21,935
Without it, PowerShell will search the entire domain.

57
00:02:23,555 --> 00:02:25,227
Since we want to search only

58
00:02:25,252 --> 00:02:26,891
in a specific Organizational Unit,

59
00:02:27,078 --> 00:02:29,008
we need to input the OU here

60
00:02:29,033 --> 00:02:30,485
in Distinguished Name format.

61
00:02:33,016 --> 00:02:34,461
To find the Distinguished Name

62
00:02:34,486 --> 00:02:36,688
of an Organizational Unit in ADUC,

63
00:02:37,243 --> 00:02:38,821
right-click on the OU,

64
00:02:38,846 --> 00:02:40,141
select "Properties",

65
00:02:40,166 --> 00:02:42,524
and it will be listed in the "Attribute Editor" tab.

66
00:02:44,664 --> 00:02:46,539
You can simply copy the Distinguished Name

67
00:02:46,564 --> 00:02:47,719
from the Attribute Editor

68
00:02:48,024 --> 00:02:50,094
and right-click to paste into PowerShell.

69
00:02:52,375 --> 00:02:54,227
Add quotes around the Distinguished Name

70
00:02:54,252 --> 00:02:55,571
and we're good to go.

71
00:02:58,336 --> 00:03:00,399
We can combine <u>Search-ADAccount</u>

72
00:03:00,423 --> 00:03:01,726
and <u>Unlock-ADAccount</u>

73
00:03:01,751 --> 00:03:02,914
 together with the pipe ( | )

74
00:03:03,282 --> 00:03:04,821
to unlock all accounts

75
00:03:04,846 --> 00:03:06,125
that are currently locked out.

76
00:03:07,711 --> 00:03:08,985
Since the command on the left

77
00:03:09,010 --> 00:03:10,875
outputs the identities of accounts,

78
00:03:11,032 --> 00:03:13,172
we don't need to use the <u>-Identity</u> parameter

79
00:03:13,197 --> 00:03:14,993
for the command on the right of the pipe.

80
00:03:20,375 --> 00:03:22,797
Verify that the account are unlocked

81
00:03:22,822 --> 00:03:25,297
by spot-checking in ADUC

82
00:03:26,469 --> 00:03:29,438
or re-run the <u>Search-ADAccount</u> command.

83
00:03:32,860 --> 00:03:34,289
No results are returned,

84
00:03:34,314 --> 00:03:35,782
so that tells us that no accounts

85
00:03:35,807 --> 00:03:36,907
are currently locked out.

86
00:03:38,766 --> 00:03:39,781
That's it!

87
00:03:39,806 --> 00:03:41,008
That's all there is to it.

88
00:03:41,368 --> 00:03:43,953
As always, the script shown in the video,

89
00:03:43,978 --> 00:03:46,196
the write-up, and the supporting scripts

90
00:03:46,328 --> 00:03:47,797
will be uploaded to my GitHub

91
00:03:47,822 --> 00:03:49,313
which is linked in the description.

92
00:03:50,227 --> 00:03:51,258
Thank you for watching.

93
00:03:51,344 --> 00:03:52,688
I hope you learned something.

